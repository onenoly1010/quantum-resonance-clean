name: Agent Label Routing

on:
  issues:
    types: [opened, labeled]
  pull_requests:
    types: [opened, labeled]

jobs:
  route:
    runs-on: ubuntu-latest
    steps:
      - name: Route to agents
        uses: actions/github-script@v7
        with:
          script: |
            const labels = context.payload.issue?.labels || context.payload.pull_request?.labels || [];
            const agentLabels = labels.filter(l => l.name.includes('-agent'));
            
            if (agentLabels.length > 0) {
              const comment = `ðŸ¤– This has been routed to: ${agentLabels.map(l => l.name).join(', ')}\n\nSee \`.github/GITHUB_AGENT_INSTRUCTIONS.md\` for coordination.`;
              
              const target = context.payload.issue || context.payload.pull_request;
              if (target) {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: target.number,
                  body: comment
                });
              }
            }
